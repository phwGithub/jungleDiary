{% extends '/common/common.html' %}
{% block title %}{{title}}{% endblock %}

{% block cdns %}
        <!-- Required meta tags -->
        <meta charset="utf-8">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap bulma -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

		<!-- JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

{% endblock %}


{% block style %}
<style type="text/css">
    .mainbox {
        width : 70%;
        margin: auto;
        margin-top:20px;
    }
    .title {
        display: block;
        font-size: 30px;
        margin: auto;
        text-align: center;
        margin-bottom: 30px;
    }
    .date{
        display: block;
        font-size:20px;
        text-align: center;
        margin-bottom:30px;
    }
    .memo_input{
        width:80%;
        margin-right: 3%;
    }
    .memo_botton{
        width:15%;
    }
    .memo_input_box{
        width:70%;
        margin:auto;
        padding-bottom:10px;
    }
    .memo_content {
        height:45px;
        padding:2.5px;
        padding-left:20px;
    }
    .memos {
        width:70%;
        margin:auto;
        padding-top:10px;
    }
    .edit_delete_botton{
        height:40px;
        margin-right:10px;
        float:right;
    }
    .memo_text{
        display:inline;
        font-size:20px;
        width:60%;
    }
</style>
{% endblock %}


{% block body %}
<div>
    <div class = 'mainbox box'>
        <div class = 'field'>
            <div>
                <h1 class="title">오늘의 메모</h1>
            </div>
            <div>
                <p class = 'date'>20{{date[0]}}. {{date[1]}}. {{date[2]}}. {{date[3]}}</p>
            </div>
            <div class="memo_input_box">
                <input id ='new_memo'class="input is-focused memo_input" type="text" placeholder="메모를 입력해주세요">
                <button onclick="appendMemo()" class="button is-info is-light memo_botton">메모하기!</button>
            </div>
            <div class="memos" id="memos">

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    let date_now = '{{date[0]}}-{{date[1]}}-{{date[2]}}'
        $(document).ready(function () {
        getMemos();
    })
    function getMemos() {
        $("#memos").html("");
        $.ajax({
            type: "post",
            url: "/api/getMemos",
            data: {'memo_date':date_now},
            success: function (response) {
                if (response.result === "success") {
                    ///다른 액션 시에 input박스들 비우기
                    $("#new_memo").val("")
                    let memos_dumps = response['user_memos'];
                    let user_memos = JSON.parse(memos_dumps);
                    for (let i = 0; i<memos.length; i++) {
                        show_memos(i,user_memos[i]['content'],user_memos[i]['_id']['$oid']);
                    }
                }
                else {
                    alert('오류발생')
                }
            }
        })
    }
    function show_memos(memo_num ,memo_content, memo_id) {
        /// link-like, 삭제는 함수&api를 만들어서 해당 버튼 누를때 id를 서버로 보내며 post한다
        /// card_num은 통해 수정버튼을 누를 시에 수정되는 카드의 id를 특정하기 위해 만든 변수로
        /// 패이지가 load 될때 card가 추가되면서 0부터 1씩 커지며 부여된다.
        /// 수정버튼을 누를 때 기존의 제목과 내용, card_num, 메모의db_id를 변수로 입력한다
        let memo_html = `<div id ='memo${memo_num}'class = 'box memo_content'>
    <p class="memo_text">${memo_text}</p>
    <button onclick='editMemo(${memo_id})' class="button is-warning is-light edit_delete_botton">수정</button>
    <button onclick='deleteMemo(${memo_id})' class="button is-danger is-light edit_delete_botton">삭제</button>
</div>`
        $("#card-list").append(card_html)
    }



    function appendMemo() {
        /// memo_title과 memo_content가 모두 입력되었는지 확인한다.
        /// memo_title, memo_content를 서버에 보내며 post, 성공 시 새로고침
        let new_memo = $("#new_memo").val();
        if (new_memo){
            $.ajax({
                type: "POST",
                url: "/api/appendMemo",
                data: {'new_memo': new_memo},
                success: function (response) { // 성공하면
                    if (response["result"] === "success") {
                        getMemos();
                    }
                    else {
                        alert("서버 오류!");
                    }
                }
            })
        }
        else {
            alert('메모 내용을 입력해주세요')
        }
    }


</script>
{% endblock %}

